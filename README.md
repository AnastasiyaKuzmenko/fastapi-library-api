# üìö Library API

RESTful API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∏–±–ª–∏–æ—Ç–µ—á–Ω—ã–º –∫–∞—Ç–∞–ª–æ–≥–æ–º —Å —Å–∏—Å—Ç–µ–º–æ–π –≤—ã–¥–∞—á–∏ –∏ –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫–Ω–∏–≥. –†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º FastAPI, SQLAlchemy, JWT-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ Alembic –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π.


## üìå –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```bash
.
‚îú‚îÄ‚îÄ .gitignore
‚îÇ    
‚îú‚îÄ‚îÄ alembic/                # –ú–∏–≥—Ä–∞—Ü–∏–∏            
‚îÇ    
‚îú‚îÄ‚îÄ app/                    
‚îÇ   ‚îú‚îÄ‚îÄ auth.py             # JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ database.py         # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î 
‚îÇ   ‚îú‚îÄ‚îÄ dependencies.py     # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (get_db, get_current_user)
‚îÇ   ‚îú‚îÄ‚îÄ main.py             # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ models.py           # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ schemas.py          # Pydantic —Å—Ö–µ–º—ã
‚îÇ   ‚îî‚îÄ‚îÄ routers/            
‚îÇ       ‚îú‚îÄ‚îÄ books.py        # CRUD –∫–Ω–∏–≥ 
‚îÇ       ‚îú‚îÄ‚îÄ borrow.py       # –í—ã–¥–∞—á–∞ –∏ –≤–æ–∑–≤—Ä–∞—Ç 
‚îÇ       ‚îú‚îÄ‚îÄ readers.py      # CRUD —á–∏—Ç–∞—Ç–µ–ª–µ–π
‚îÇ       ‚îî‚îÄ‚îÄ users.py        # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –ª–æ–≥–∏–Ω
‚îÇ    
‚îú‚îÄ‚îÄ tests/                  # Pytest —Ç–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ conftest.py          
‚îÇ   ‚îú‚îÄ‚îÄ test_books.py        
‚îÇ   ‚îú‚îÄ‚îÄ test_borrow.py       
‚îÇ   ‚îú‚îÄ‚îÄ test_readers.py      
‚îÇ   ‚îî‚îÄ‚îÄ test_users.py        
‚îÇ
‚îú‚îÄ‚îÄ requirements.txt        # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îÇ
‚îú‚îÄ‚îÄ run_test.sh             # –ó–∞–ø—É—Å–∫–∞–µ—Ç pytest —Ç–µ—Å—Ç—ã –∏ flake8    
‚îÇ
‚îú‚îÄ‚îÄ .flake8                 # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ flake8     
‚îÇ    
‚îî‚îÄ‚îÄ README.md       

```

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

#### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
```bash
git clone https://github.com/AnastasiyaKuzmenko/fastapi-library-api.git  
cd fastapi-library-api
```
#### 2. –°–æ–∑–¥–∞—Ç—å –∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
```bash
python3 -m venv venv
source venv/bin/activate
```
#### 3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```bash
pip install -r requirements.txt
```

#### 4. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª .env –∏ –∑–∞–¥–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–í —Ñ–∞–π–ª–µ .env:
```bash
 DATABASE_URL=sqlite:///./library.db
 SECRET_KEY=–≤–∞—à_—Å–µ–∫—Ä–µ—Ç–Ω—ã–π_–∫–ª—é—á
```
#### 5. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
```bash
alembic upgrade head
```
#### 6. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
```bash
uvicorn app.main:app --reload
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
#### –ó–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ pytest —Ç–µ—Å—Ç–æ–≤
```bash
pytest tests/
```
#### –ó–∞–ø—É—Å–∫ pytest —Ç–µ—Å—Ç–æ–≤ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ —Å –ø–æ–º–æ—â—å—é flake8
```bash
chmod +x run_test.sh
./run_test.sh
```

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è: POST `/auth/register` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å email –∏ –ø–∞—Ä–æ–ª–µ–º.
- –í—Ö–æ–¥: POST `/auth/login` ‚Äî –≤–æ–∑–≤—Ä–∞—Ç JWT-—Ç–æ–∫–µ–Ω–∞.
- –ó–∞—â–∏—â—ë–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:
    - –í—Å–µ CRUD-–æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞–¥ –∫–Ω–∏–≥–∞–º–∏, —á–∏—Ç–∞—Ç–µ–ª—è–º–∏, –∞ —Ç–∞–∫–∂–µ –≤—ã–¥–∞—á–∞/–≤–æ–∑–≤—Ä–∞—Ç –∫–Ω–∏–≥ –∑–∞—â–∏—â–µ–Ω—ã JWT.
    - –ò—Å–∫–ª—é—á–µ–Ω–∏—è: `/users/register`, `/users/login`, `/books/`, `/books/{book_id}` ‚Äî –ø—É–±–ª–∏—á–Ω—ã.
    –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –ø–æ–ª—É—á–µ–Ω–∏—è –∫–Ω–∏–≥ (`GET /books/` –∏  `GET /books/{id}`) –æ—Å—Ç–∞–≤–ª–µ–Ω—ã –æ—Ç–∫—Ä—ã—Ç—ã–º–∏, —Ç–∞–∫ –∫–∞–∫ –¥–æ—Å—Ç—É–ø –∫ –∫–∞—Ç–∞–ª–æ–≥—É –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–µ–Ω –¥–ª—è —á–∏—Ç–∞—Ç–µ–ª–µ–π —Ç–æ–∂–µ.

- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏:
    - `python-jose` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å JWT.
    - `passlib[bcrypt]` –¥–ª—è —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π.
- –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:
    - –ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç email –∏ –ø–∞—Ä–æ–ª—å. –ü–∞—Ä–æ–ª—å —Ö–µ—à–∏—Ä—É–µ—Ç—Å—è –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è.
    - –ü—Ä–∏ –ª–æ–≥–∏–Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è JWT —Ç–æ–∫–µ–Ω, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç `sub = user.email` –∏ —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è.
    - –í—Å–µ –∑–∞—â–∏—â—ë–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç Depends(`get_current_user`)

## üß± –ü—Ä–∏–Ω—è—Ç—ã–µ —Ä–µ—à–µ–Ω–∏—è –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –ë–î
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (User) ‚Äî –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ä–µ–π. –°–æ–¥–µ—Ä–∂–∏—Ç email –∏ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å.
- –ö–Ω–∏–≥–∏ (Book) ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–Ω–∏–≥–∞—Ö, –≤–∫–ª—é—á–∞—è —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ISBN –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤.
- –ß–∏—Ç–∞—Ç–µ–ª–∏ (Reader) ‚Äî —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ä—è–º–∏, —Å–æ–¥–µ—Ä–∂–∞—Ç –∏–º—è –∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π email.
- –í—ã–¥–∞—á–∏ (BorrowedBook) ‚Äî –æ—Ç–¥–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è —Ñ–∏–∫—Å–∞—Ü–∏–∏ —Ñ–∞–∫—Ç–æ–≤ –≤—ã–¥–∞—á–∏, —Å–æ–¥–µ—Ä–∂–∏—Ç book_id, reader_id, –¥–∞—Ç—É –≤—ã–¥–∞—á–∏ –∏ –¥–∞—Ç—É –≤–æ–∑–≤—Ä–∞—Ç–∞ (return_date).

## üß† –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
#### 1. –í—ã–¥–∞—á–∞ –∫–Ω–∏–≥–∏ (`/borrow/checkout`):

- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤: copies_available > 0
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ —É —á–∏—Ç–∞—Ç–µ–ª—è: –Ω–µ –±–æ–ª–µ–µ 3 –∫–Ω–∏–≥
- –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –≤—ã–¥–∞—á–µ:
    - —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è copies_available –Ω–∞ 1
    - —Å–æ–∑–¥–∞—ë—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ BorrowedBooks —Å `return_date = NULL`

#### 2. –í–æ–∑–≤—Ä–∞—Ç –∫–Ω–∏–≥–∏ (`/borrow/return`):
- –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –∑–∞–ø–∏—Å—å –æ –≤—ã–¥–∞—á–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∞
- –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è copies_available –Ω–∞ 1
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è `return_date = —Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞`

#### 3. –ó–∞–ø—Ä–µ—Ç –Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω—É—é –≤—ã–¥–∞—á—É —É–∂–µ –≤—ã–¥–∞–Ω–Ω–æ–π –∫–Ω–∏–≥–∏, –∏ –≤–æ–∑–≤—Ä–∞—Ç —É–∂–µ –≤–æ–∑–≤—Ä–∞—â—ë–Ω–Ω–æ–π ‚Äî –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–æ–π —á–µ—Ä–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ 
`return_date IS NULL.`


## ‚ùó –°–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏ –∫–∞–∫ –æ–Ω–∏ –±—ã–ª–∏ —Ä–µ—à–µ–Ω—ã
- JWT —Ç–æ–∫–µ–Ω –Ω–µ –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞–ª—Å—è:
–î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ get_current_user, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—â–∞—è OAuth2PasswordBearer.

- –ü—Ä–æ–±–ª–µ–º–∞ —Å –≤–æ–∑–≤—Ä–∞—Ç–æ–º —É–∂–µ –≤–æ–∑–≤—Ä–∞—â—ë–Ω–Ω–æ–π –∫–Ω–∏–≥–∏:
–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ return_date IS NULL –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ.

- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ 3 –∫–Ω–∏–≥–∏ —É —á–∏—Ç–∞—Ç–µ–ª—è:
–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ SQL-–∑–∞–ø—Ä–æ—Å count() –ø–æ BorrowedBooks WHERE reader_id=? AND return_date IS NULL.

- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è —á–µ—Ä–µ–∑ –º–∏–≥—Ä–∞—Ü–∏—é:
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω alembic revision --autogenerate –¥–ª—è –ø–æ–ª—è description –≤ —Ç–∞–±–ª–∏—Ü–µ Book.